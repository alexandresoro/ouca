generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Age {
  id       Int        @id @default(autoincrement()) @db.UnsignedSmallInt
  libelle  String     @unique(map: "unique_libelle") @db.VarChar(100)
  donnee   Donnee[]
  settings Settings[]

  @@map("age")
}

model Classe {
  id      Int      @id @default(autoincrement()) @db.UnsignedSmallInt
  libelle String   @unique(map: "unique_libelle") @db.VarChar(100)
  espece  Espece[]

  @@map("classe")
}

model Commune {
  id            Int         @id @default(autoincrement()) @db.UnsignedSmallInt
  departementId Int         @map("departement_id") @db.UnsignedSmallInt
  code          Int         @db.UnsignedSmallInt
  nom           String      @db.VarChar(100)
  departement   Departement @relation(fields: [departementId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_commune_departement_id")
  lieudit       Lieudit[]

  @@unique([departementId, code], map: "unique_departement_code")
  @@unique([departementId, nom], map: "unique_departement_nom")
  @@map("commune")
}

enum Nicheur {
  possible
  probable
  certain
}

model Comportement {
  id                  Int                   @id @default(autoincrement()) @db.UnsignedSmallInt
  code                String                @unique(map: "unique_code") @db.VarChar(6)
  libelle             String                @unique(map: "unique_libelle") @db.VarChar(100)
  nicheur             Nicheur?
  donnee_comportement donnee_comportement[]

  @@map("comportement")
}

model Departement {
  id       Int        @id @default(autoincrement()) @db.UnsignedSmallInt
  code     String     @unique(map: "unique_code") @db.VarChar(100)
  commune  Commune[]
  settings Settings[]

  @@map("departement")
}

model Donnee {
  id                   Int                   @id @default(autoincrement()) @db.UnsignedMediumInt
  inventaireId         Int                   @map("inventaire_id") @db.UnsignedMediumInt
  especeId             Int                   @map("espece_id") @db.UnsignedMediumInt
  sexeId               Int                   @map("sexe_id") @db.UnsignedSmallInt
  ageId                Int                   @map("age_id") @db.UnsignedSmallInt
  estimationNombreId   Int                   @map("estimation_nombre_id") @db.UnsignedSmallInt
  nombre               Int?                  @db.UnsignedSmallInt
  estimationDistanceId Int?                  @map("estimation_distance_id") @db.UnsignedSmallInt
  distance             Int?                  @db.UnsignedSmallInt
  commentaire          String?               @db.Text
  regroupement         Int?                  @db.UnsignedSmallInt
  date_creation        DateTime              @db.DateTime(0)
  age                  Age                   @relation(fields: [ageId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_donnee_age_id")
  espece               Espece                @relation(fields: [especeId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_donnee_espece_id")
  estimationDistance   EstimationDistance?   @relation(fields: [estimationDistanceId], references: [id], onUpdate: Restrict, map: "fk_donnee_estimation_distance_id")
  estimationNombre     EstimationNombre      @relation(fields: [estimationNombreId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_donnee_estimation_nombre_id")
  inventaire           Inventaire            @relation(fields: [inventaireId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_donnee_inventaire_id")
  sexe                 Sexe                  @relation(fields: [sexeId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_donnee_sexe_id")
  donnee_comportement  donnee_comportement[]
  donnee_milieu        donnee_milieu[]

  @@index([ageId], map: "fk_donnee_age_id")
  @@index([especeId], map: "fk_donnee_espece_id")
  @@index([estimationDistanceId], map: "fk_donnee_estimation_distance_id")
  @@index([estimationNombreId], map: "fk_donnee_estimation_nombre_id")
  @@index([inventaireId], map: "fk_donnee_inventaire_id")
  @@index([sexeId], map: "fk_donnee_sexe_id")
  @@map("donnee")
}

model donnee_comportement {
  donnee_id       Int          @db.UnsignedMediumInt
  comportement_id Int          @db.UnsignedSmallInt
  comportement    Comportement @relation(fields: [comportement_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_donnee_comportement_comportement_id")
  donnee          Donnee       @relation(fields: [donnee_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_donnee_comportement_donnee_id")

  @@id([donnee_id, comportement_id])
  @@index([comportement_id], map: "fk_donnee_comportement_comportement_id")
}

model donnee_milieu {
  donnee_id Int    @db.UnsignedMediumInt
  milieu_id Int    @db.UnsignedSmallInt
  donnee    Donnee @relation(fields: [donnee_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_donnee_milieu_donnee_id")
  milieu    Milieu @relation(fields: [milieu_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_donnee_milieu_milieu_id")

  @@id([donnee_id, milieu_id])
  @@index([milieu_id], map: "fk_donnee_milieu_milieu_id")
}

model Espece {
  id          Int      @id @default(autoincrement()) @db.UnsignedMediumInt
  classeId    Int?     @map("classe_id") @db.UnsignedSmallInt
  code        String   @unique(map: "unique_code") @db.VarChar(20)
  nomFrancais String   @unique(map: "unique_nom_francais") @map("nom_francais") @db.VarChar(100)
  nomLatin    String   @unique(map: "unique_nom_latin") @map("nom_latin") @db.VarChar(100)
  classe      Classe?  @relation(fields: [classeId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_espece_classe_id")
  donnee      Donnee[]

  @@index([classeId], map: "fk_espece_classe_id")
  @@map("espece")
}

model EstimationDistance {
  id      Int      @id @default(autoincrement()) @db.UnsignedSmallInt
  libelle String   @unique(map: "unique_libelle") @db.VarChar(100)
  donnee  Donnee[]

  @@map("estimation_distance")
}

model EstimationNombre {
  id        Int        @id @default(autoincrement()) @db.UnsignedSmallInt
  libelle   String     @unique(map: "unique_libelle") @db.VarChar(100)
  nonCompte Boolean    @map("non_compte") @db.Bit(1)
  donnee    Donnee[]
  settings  Settings[]

  @@map("estimation_nombre")
}

model Inventaire {
  id                 Int                  @id @default(autoincrement()) @db.UnsignedMediumInt
  observateurId      Int                  @map("observateur_id") @db.UnsignedSmallInt
  date               DateTime             @db.Date
  heure              String?              @db.VarChar(5)
  duree              String?              @db.VarChar(5)
  lieuDitId          Int                  @map("lieudit_id") @db.UnsignedMediumInt
  altitude           Int?                 @db.UnsignedSmallInt
  longitude          Decimal?             @db.Decimal(13, 6)
  latitude           Decimal?             @db.Decimal(13, 6)
  coordinates_system CoordinatesSystem?
  temperature        Int?                 @db.TinyInt
  date_creation      DateTime             @db.DateTime(0)
  lieuDit            Lieudit              @relation(fields: [lieuDitId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_inventaire_lieudit_id")
  observateur        Observateur          @relation(fields: [observateurId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_inventaire_observateur_id")
  donnee             Donnee[]
  inventaire_associe inventaire_associe[]
  inventaire_meteo   inventaire_meteo[]

  @@index([lieuDitId], map: "fk_inventaire_lieudit_id")
  @@index([observateurId], map: "fk_inventaire_observateur_id")
  @@map("inventaire")
}

model inventaire_associe {
  inventaire_id  Int         @db.UnsignedMediumInt
  observateur_id Int         @db.UnsignedSmallInt
  inventaire     Inventaire  @relation(fields: [inventaire_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_inventaire_associe_inventaire_id")
  observateur    Observateur @relation(fields: [observateur_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_inventaire_associe_observateur_id")

  @@id([inventaire_id, observateur_id])
  @@index([observateur_id], map: "fk_inventaire_associe_observateur_id")
}

model inventaire_meteo {
  inventaire_id Int        @db.UnsignedMediumInt
  meteo_id      Int        @db.UnsignedSmallInt
  inventaire    Inventaire @relation(fields: [inventaire_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_inventaire_meteo_inventaire_id")
  meteo         Meteo      @relation(fields: [meteo_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_inventaire_meteo_meteo_id")

  @@id([inventaire_id, meteo_id])
  @@index([meteo_id], map: "fk_inventaire_meteo_meteo_id")
}

model Lieudit {
  id                Int               @id @default(autoincrement()) @db.UnsignedMediumInt
  communeId         Int               @map("commune_id") @db.UnsignedSmallInt
  nom               String            @db.VarChar(150)
  altitude          Int               @db.UnsignedSmallInt
  longitude         Decimal           @db.Decimal(13, 6)
  latitude          Decimal           @db.Decimal(16, 6)
  coordinatesSystem CoordinatesSystem @map("coordinates_system")
  commune           Commune           @relation(fields: [communeId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_lieudit_commune_id")
  inventaire        Inventaire[]

  @@unique([communeId, nom], map: "unique_commune_nom")
  @@map("lieudit")
}

model Meteo {
  id               Int                @id @default(autoincrement()) @db.UnsignedSmallInt
  libelle          String             @unique(map: "unique_libelle") @db.VarChar(100)
  inventaire_meteo inventaire_meteo[]

  @@map("meteo")
}

model Milieu {
  id            Int             @id @default(autoincrement()) @db.UnsignedSmallInt
  code          String          @unique(map: "unique_code") @db.VarChar(6)
  libelle       String          @unique(map: "unique_libelle") @db.VarChar(100)
  donnee_milieu donnee_milieu[]

  @@map("milieu")
}

model Observateur {
  id                 Int                  @id @default(autoincrement()) @db.UnsignedSmallInt
  libelle            String               @unique(map: "unique_libelle") @db.VarChar(100)
  ownerId            String               @map("owner_id")
  inventaire         Inventaire[]
  inventaire_associe inventaire_associe[]
  owner              User                 @relation(fields: [ownerId], references: [id], onUpdate: Restrict, map: "fk_observateur_owner_id")
  settings           Settings[]

  @@map("observateur")
}

enum CoordinatesSystem {
  gps
  lambert93
}

model Settings {
  id                        Int               @id @default(autoincrement()) @db.UnsignedSmallInt
  defaultObservateurId      Int?              @map("default_observateur_id") @db.UnsignedSmallInt
  defaultDepartementId      Int?              @map("default_departement_id") @db.UnsignedSmallInt
  defaultAgeId              Int?              @map("default_age_id") @db.UnsignedSmallInt
  defaultSexeId             Int?              @map("default_sexe_id") @db.UnsignedSmallInt
  defaultEstimationNombreId Int?              @map("default_estimation_nombre_id") @db.UnsignedSmallInt
  defaultNombre             Int?              @map("default_nombre") @db.UnsignedSmallInt
  areAssociesDisplayed      Boolean           @default(true) @map("are_associes_displayed") @db.Bit(1)
  isMeteoDisplayed          Boolean           @default(true) @map("is_meteo_displayed") @db.Bit(1)
  isDistanceDisplayed       Boolean           @default(true) @map("is_distance_displayed") @db.Bit(1)
  isRegroupementDisplayed   Boolean           @default(true) @map("is_regroupement_displayed") @db.Bit(1)
  coordinatesSystem         CoordinatesSystem @default(gps) @map("coordinates_system")
  defaultAge                Age?              @relation(fields: [defaultAgeId], references: [id], onUpdate: Restrict, map: "fk_settings_age_id")
  defaultDepartement        Departement?      @relation(fields: [defaultDepartementId], references: [id], onUpdate: Restrict, map: "fk_settings_departement_id")
  defaultEstimationNombre   EstimationNombre? @relation(fields: [defaultEstimationNombreId], references: [id], onUpdate: Restrict, map: "fk_settings_estimation_nombre_id")
  defaultObservateur        Observateur?      @relation(fields: [defaultObservateurId], references: [id], onUpdate: Restrict, map: "fk_settings_observateur_id")
  defaultSexe               Sexe?             @relation(fields: [defaultSexeId], references: [id], onUpdate: Restrict, map: "fk_settings_sexe_id")

  @@index([defaultAgeId], map: "fk_settings_age_id")
  @@index([defaultDepartementId], map: "fk_settings_departement_id")
  @@index([defaultEstimationNombreId], map: "fk_settings_estimation_nombre_id")
  @@index([defaultObservateurId], map: "fk_settings_observateur_id")
  @@index([defaultSexeId], map: "fk_settings_sexe_id")
  @@map("settings")
}

model Sexe {
  id       Int        @id @default(autoincrement()) @db.UnsignedSmallInt
  libelle  String     @unique(map: "unique_libelle") @db.VarChar(100)
  donnee   Donnee[]
  settings Settings[]

  @@map("sexe")
}

enum DatabaseRole {
  admin
  contributor
}

model User {
  id          String        @id @default(uuid())
  username    String        @unique(map: "unique_username") @db.VarChar(50)
  password    String        @db.VarChar(161)
  role        DatabaseRole
  firstName   String        @map("first_name") @db.VarChar(50)
  lastName    String?       @map("last_name") @db.VarChar(50)
  observateur Observateur[]

  @@map("user")
}

model Version {
  version Int @id @db.UnsignedSmallInt

  @@map("version")
}
